# 项目通关指南

> If you tell yourself you can’t, you won’t.

Hi，各位同学们，这是一篇简明项目通关指南~注意的内容一定要看no~

**注意**：

- 请使用Chrome或者火狐浏览器。
- 项目看起来代码量很大，其实大部分都已经写好了，大家只需要对部分进行替换或者填空就行，所以别怕。
- 项目主要是为了让大家体验数据分析的流程和Udacity的项目审阅流程，代码在正式课程中都会有讲解。
- 如果你是小白，就在这短短的几天理解每一行代码可能有点困难，你只需要理解每个代码框的含义就好了~
- 学有余力的同学想要弄清楚每一行代码的话，可以来找助教私下探讨。
- 如果比较心虚，那**周六晚上的优达日公开课**请一定要腾出时间来（~~如果有约会的话，不如拉上另一半来看优达日？~~），重点就是**带大家过一遍项目**

# 项目流程

## 0.Jupyter Notebook的基本操作

### 面板

- 常用的就这么多，大家一定要记得随时保存。

![ijwIVH.png](https://s1.ax1x.com/2018/11/14/ijwIVH.png)

- 在`单元框格式选择`中，可以选择`代码`或者`标记`。

  - 当你输入代码时，就选择`代码`，这样你的代码才能被执行。
  - 当你整个框是输入文字的时候，就选择`标记`，这样你就可以对文字进行排版设计了。

  如下示例：

  ![ijwzZQ.png](https://s1.ax1x.com/2018/11/14/ijwzZQ.png)

### 注意事项（敲黑板！！）

当你重新打开项目网页时，需要从最开始的代码框按照顺序重新运行一遍，要不然就会出现明明之前定义了的变量，却提示没定义。

![ijDaxP.png](https://s1.ax1x.com/2018/11/14/ijDaxP.png)

## 1.提出问题

![ijDqR1.png](https://s1.ax1x.com/2018/11/14/ijDqR1.png)

我们的项目题目是中国五个城市的**PM2.5**分析，所以关键变量应该是**PM2.5**，所有提出的问题也都应该围绕着PM2.5。

这里需要**注意**的是：

- 通过后面的数据评估，可以得知部分城市2010和2011年的数据有所缺失，所以你在选择时间的时候最好避开这两年；
- 在后面的数据筛选中，考虑到项目的**体验性**，我们只筛选了数据中的部分变量，也就是上图红框中的变量，所以你在提出问题时应该从这几个变量入手。

示例：

1. 2012年-2015年上海市PM 2.5的数据在不同的月份有什么变化趋势？
2. 2015年北京市PM 2.5的数据在不同的季节有什么变化趋势？

## 2.数据评估

数据评估这里是挑了上海市进行示范举例，这部分代码你直接运行就好，看一下结果，尝试着去理解代码。

之后，你需要做的呢，就是从其余四个城市中，挑一个你喜欢的，按照前面的例子操作一遍，回答问题2a和问题2b。

示范：

比如说，我挑的北京市，那么就把文件名这里（下图红线标识），替换为“Beijing”就可以啦

![ijrtwF.png](https://s1.ax1x.com/2018/11/14/ijrtwF.png)

**注意**：你定义的变量就按项目中默认得来就行，也就是`city_data`不要改。

## 3.数据整理

数据整理这部分的目的呢就是为了将五个城市的数据合并在一起，用城市名称给他们加上区分的标签，并且筛选了部分变量。这部分代码不需要大家进行更改，只需要按顺序运行就好。

代码解释如下，知道这一步骤的目的就好~不要纠结“为什么要这样写”，等进入到正式班，学上两个礼拜，你就什么都知道了，哈哈哈。

```python
#定义一个由各城市数据文件名组成的列表
files = ['BeijingPM20100101_20151231.csv',
       'ChengduPM20100101_20151231.csv',
       'GuangzhouPM20100101_20151231.csv',
       'ShanghaiPM20100101_20151231.csv',
       'ShenyangPM20100101_20151231.csv']

#定义一个筛选变量组成的列表
out_columns = ['No', 'year', 'month', 'day', 'hour', 'season', 'PM_US Post']
```

```python
#定义一个空的DataFrame（可以理解为定义一个新表格）
df_all_cities = pd.DataFrame()
```

```python
#使用for循环，将五个城市数据进行合并，并添加城市名称扽等，保存在刚定义的空表格中
for inx, val in enumerate(files):
    df = pd.read_csv(val) #读取文件
    df = df[out_columns] #筛选变量
    # 定义一个新列，名称为城市的名称
    df['city'] = val.split('P')[0]
    #处理season列，将1-4改为春-冬
    df['season'] = df['season'].map({1:'Spring', 2:'Summer', 3:'Autumn', 4: 'Winter'})
    #将各个城市的数据依次保存在新表df_all_cities中
    df_all_cities = df_all_cities.append(df)
```

```python
#将列名中的空格用下划线代替
df_all_cities.columns = [c.replace(' ', '_') for c in df_all_cities.columns]
```

## 4.数据筛选

为了方便大家进行数据筛选，这里定义了两个函数，一个是**筛选函数 filter_data**，一个是**分析函数 reading_stats**，但我们后面用到的只有**reading_stats**这一个。

> 还是那句话，不要怕，也不要纠结这大段的代码是怎么写出来的，等你学完正式班的P2（大概一个月之后吧），你也能写出来了~，现在呢，只要会用这个函数就OK啦。

- 第一个函数：filter_data是一个筛选函数，它可以根据你输入的条件对数据进行筛选。
- 第二个函数：**reading_stats**是一个基于filter_data的分析函数，它会调用filter_data的筛选结果进行分析，返回筛选后数据的统计信息和一幅箱线图。

在这里，我们只关注reading_stats函数的用法。你要根据你提出的问题去筛选合适的数据，比如说，你提出的问题是：“2012年-2015年上海市PM 2.5的数据在不同的月份有什么变化趋势？”，这里就有俩个筛选条件，一个是时间：2012-2015，一个是城市：上海（这也是问题3a的答案示例），所以我们筛选数据的时候应该输入：

```python
df_1 = reading_stats(df_all_cities, ["city == 'Shanghai'", "year >= 2012"])
#这也是问题3b的答案示例
```

**注意**：

- **城市的名称**是字符串，所以也要**放在引号里**，建议用单引号，如`'Shanghai'`；
- 筛选条件中的比较**运算符两侧要加空格**，如`year >= 2012`
- 两个问题对应的应该是两个变量名`df_1`和`df_2`。

**拓展**：

如果你想对比两个城市怎么办？比如说，我想看下2012年北京和成都的PM2.5浓度哪个更重。

按照刚才的思路，这里你的筛选条件应该有：

- city == 'Beijing'
- city == 'Chengdu'
- year == 2012

但是，你真这样进行筛选的话，会发现结果的数据为0。因为这几个筛选条件是**递进**式的，并不是并列式的，也就是说，他会按照你输入条件的顺序进行筛选，那按照我们上面写的筛选条件，他会先筛选出北京的数据，然后在北京的数据中筛选出成都的数据（咋可能筛选的出？），所以，这里的筛选条件应该这样写：

- city != 'Shanghai'
- city != 'Shenyang'
- city != 'Guangzhou'
- year == 2012

这样，他会先筛选出不是上海的数据，在此基础上筛选出不是沈阳的数据，然后再筛选出不是广州的数据，也就只剩下北京和成都的数据了，这样就能筛选出合适的数据啦。

## 5.EDA与可视化

呐，在这里又出现了一个魔鬼，不用管他，运行一下，看下面的函数使用指南就好。

这里定义了一个可视化函数**univariate_plot**，他会根据你输入的数据集（你上一步筛选出来的），分析的维度（也就是按年/月/季节等进行数据比较）和颜色（非必需），输出一个柱状图。

比如说，我的第一个问题是2012年-2015年上海市PM 2.5的数据在**不同的月份**有什么变化趋势？

- 数据集：在上一步**数据筛选**中已经筛选出了，对应的数据集为`df_1`（第一个问题嘛）
- 分析维度：问题中对比的是“不同的月份”，所以分析维度为月份，也就是`month`

所以，进行可视化的代码为：

```python
univariate_plot(df_1, 'month')
```

这里唯一需要注意的点就是，你两个问题对应的数据集别搞混了。

## 6.结论

注意啦，结论这里还有一个调皮的**问题5**，别忘了回答。

## 7.提交项目

- 在`File`中，保存两种格式的文件：html和ipynb到本地。

![ijwTIA.png](https://s1.ax1x.com/2018/11/14/ijwTIA.png)

- 将两个文件打一个**zip**格式的压缩包，注意压缩包的**文件名不要出现中文或者空格**

- 按照提示提交项目即可，**注意：提交项目时记得把教室的语言设置为中文**

  ![ivcSrq.png](https://s1.ax1x.com/2018/11/15/ivcSrq.png)

# 最后

不要被代码吓到，所有的代码都是纸老虎，加油~
