# 每日导学 - Day4

> Nothing is particularly hard if you divide it into small jobs.

Hi，各位同学们，今天周六啦，前面几天太忙的同学正好趁这个机会赶紧补一下进度，另外，今天晚上八点半左右，不要忘了来参加**优达日公开课**哦~

**注意**：

- 请使用Chrome或者火狐浏览器。

- 项目看起来代码量很大，其实大部分都已经写好了，大家只需要对部分进行替换或者填空就行，所以别怕。
- 项目主要是为了让大家体验数据分析的流程和Udacity的项目审阅流程，代码在正式课程中都会有讲解。
- 如果你是小白，就在这短短的几天理解每一行代码可能有点困难，你只需要理解每个代码框的含义就好了~
- 学有余力的同学想要弄清楚每一行代码的话，可以来找助教私下探讨。
- 如果比较心虚，那**今天晚上的优达日公开课**请一定要腾出时间来（~~如果有约会的话，不如拉上另一半来看优达日？~~），重点就是**带大家过一遍项目**

**如何提问**：

在课程学习中难免会遇到问题，请按照以下流程进行问题提问：

- **课程知识问题**：

  - 先自行查找问题答案，参考：谷歌/必应搜索、[菜鸟教程](http://www.runoob.com/sql/sql-tutorial.html)、[CSDN](https://www.csdn.net/)、[stack**overflow**](https://stackoverflow.com/)
  - 若问题未解决，请将**问题**及其**所在课程章节**发送至微信群，并@助教-Allen即可

- **非课程知识问题**：

  比如账号登录、课程加载等问题，请详细描述问题，反馈给班主任即可；

  有关于后续正式课程、服务的疑问和选课建议，联系你的学习规划师就行~

# 今日目标

- 数据整理   
- 数据筛选

# 知识清单

## 1.数据整理

数据整理这部分的目的呢就是为了将五个城市的数据合并在一起，用城市名称给他们加上区分的标签，并且筛选了部分变量。这部分代码不需要大家进行更改，只需要按顺序运行就好。

代码解释如下，知道这一步骤的目的就好~不要纠结“为什么要这样写”，等进入到正式班，学上两个礼拜，你就什么都知道了，哈哈哈。

```python
#定义一个由各城市数据文件名组成的列表
files = ['BeijingPM20100101_20151231.csv',
       'ChengduPM20100101_20151231.csv',
       'GuangzhouPM20100101_20151231.csv',
       'ShanghaiPM20100101_20151231.csv',
       'ShenyangPM20100101_20151231.csv']

#定义一个筛选变量组成的列表
out_columns = ['No', 'year', 'month', 'day', 'hour', 'season', 'PM_US Post']
```

```python
#定义一个空的DataFrame（可以理解为定义一个新表格）
df_all_cities = pd.DataFrame()
```

```python
#使用for循环，将五个城市数据进行合并，并添加城市名称扽等，保存在刚定义的空表格中
for inx, val in enumerate(files):
    df = pd.read_csv(val) #读取文件
    df = df[out_columns] #筛选变量
    # 定义一个新列，名称为城市的名称
    df['city'] = val.split('P')[0]
    #处理season列，将1-4改为春-冬
    df['season'] = df['season'].map({1:'Spring', 2:'Summer', 3:'Autumn', 4: 'Winter'})
    #将各个城市的数据依次保存在新表df_all_cities中
    df_all_cities = df_all_cities.append(df)
```

```python
#将列名中的空格用下划线代替
df_all_cities.columns = [c.replace(' ', '_') for c in df_all_cities.columns]
```

## 2.数据筛选

为了方便大家进行数据筛选，这里定义了两个函数，一个是**筛选函数 filter_data**，一个是**分析函数 reading_stats**，但我们后面用到的只有**reading_stats**这一个。

> 还是那句话，不要怕，也不要纠结这大段的代码是怎么写出来的，等你学完正式班的P2（大概一个月之后吧），你也能写出来了~，现在呢，只要会用这个函数就OK啦。

- 第一个函数：filter_data是一个筛选函数，它可以根据你输入的条件对数据进行筛选。
- 第二个函数：**reading_stats**是一个基于filter_data的分析函数，它会调用filter_data的筛选结果进行分析，返回筛选后数据的统计信息和一幅箱线图。

在这里，我们只关注reading_stats函数的用法。你要根据你提出的问题去筛选合适的数据，比如说，你提出的问题是：“2012年-2015年上海市PM 2.5的数据在不同的月份有什么变化趋势？”，这里就有俩个筛选条件，一个是时间：2012-2015，一个是城市：上海（这也是问题3a的答案示例），所以我们筛选数据的时候应该输入：

```python
df_1 = reading_stats(df_all_cities, ["city == 'Shanghai'", "year >= 2012"])
#这也是问题3b的答案示例
```

**注意**：

- **城市的名称**是字符串，所以也要**放在引号里**，建议用单引号，如`'Shanghai'`；
- 筛选条件中的比较**运算符两侧要加空格**，如`year >= 2012`
- 两个问题对应的应该是两个变量名`df_1`和`df_2`。

**拓展**：

如果你想对比两个城市怎么办？比如说，我想看下2012年北京和成都的PM2.5浓度哪个更重。

按照刚才的思路，这里你的筛选条件应该有：

- city == 'Beijing'
- city == 'Chengdu'
- year == 2012

但是，你真这样进行筛选的话，会发现结果的数据为0。因为这几个筛选条件是**递进**式的，并不是并列式的，也就是说，他会按照你输入条件的顺序进行筛选，那按照我们上面写的筛选条件，他会先筛选出北京的数据，然后在北京的数据中筛选出成都的数据（咋可能筛选的出？），所以，这里的筛选条件应该这样写：

- city != 'Shanghai'
- city != 'Shenyang'
- city != 'Guangzhou'
- year == 2012

这样，他会先筛选出不是上海的数据，在此基础上筛选出不是沈阳的数据，然后再筛选出不是广州的数据，也就只剩下北京和成都的数据了，这样就能筛选出合适的数据啦。

# 最后

只强调两点：

一、不要逐行纠结代码，搞清楚模块怎么用就OK；

二、你的筛选条件，不要忘了在运算符两端加空格。